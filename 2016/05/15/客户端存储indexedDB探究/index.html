<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>客户端存储indexedDB探究 | MINFIVE BLOG</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="John Doe"><meta name="designer" content="minfive"><meta name="keywords" content="minfive, minfive blog, 前端博客, 前端, 程序员, 前端开发, 全栈开发, node.js, javascript"><meta name="description" content="个人博客，用于分享一些在日常学习工作甚至于生活中遇到的一些比较有趣的东西。七荤八素，胡言乱语，望各位看官见谅。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://blog.minfive.com/2016/05/15/客户端存储indexedDB探究/index.html"><link rel="icon" type="image/png" href="http://oo12ugek5.bkt.clouddn.com/blog/images/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="MINFIVE"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e3267498201dfa9699a5c509424709d6";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-108468870-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-108468870-1")</script><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(http://oo12ugek5.bkt.clouddn.com/blog/images/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="MINFIVE" alt="MINFIVE"><img src="http://oo12ugek5.bkt.clouddn.com/images/logo-text-white.png" alt="MINFIVE"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/demo" alt="作品" title="作品">作品</a></li><li class="nav__item"><a href="/music" alt="音乐" title="音乐">音乐</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/dbdm-large.png" alt="客户端存储indexedDB探究"></div><header class="post__info"><h1 class="post__title">客户端存储indexedDB探究</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://github.com/Mrminfive">minfive</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2016年5月15日</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/学习/">学习</a></li><li class="mark__item"><a href="/tags/javascript/">Javascript</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>趁着最近清闲，把先前落下的红宝书下半部分给看完了，最感冒的是客户端存储，WebSocket以及canvas（WebGL），WebSocket这个我就不说了，剩下的一个是我认为将来会在移动应用上大显身手的东西，一个则是前端可视化大趋势下必不可少的东西，canvas（WebGL）的话因为暂时还没入坑，所以先不讲，以后研究完了会补上来，这篇文章就主讲客户端存储。</p><blockquote><p>文章基于《javascript高级程序设计》23章以及MDN技术文档加上个人的一些见解，结构主体是技术文档，穿插一些个人踩坑的总结，如见解有误，请指出，谢谢！</p></blockquote><hr><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><code>IndexedDB</code>本片文章的主人公，在红包书中的解释是:”Indexed Database API,是在浏览器中保存结构化数据的一种<code>数据库</code>“，对的！你没看错，就是数据库，而且是一种类SQL的结构型数据库，最大的特色就是用对象来存储数据，容量以及数据存储查询速度远比storage（local/session）好的多，但缺点就是支持程度还不是很好。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>由于目前兼容性的问题，所以使用前需要对浏览器提供的API进行兼容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.indexedDB = <span class="built_in">window</span>.indexedDB || <span class="built_in">window</span>.mozIndexedDB || <span class="built_in">window</span>.webkitIndexedDB || <span class="built_in">window</span>.msIndexedDB;</div><div class="line"><span class="built_in">window</span>.IDBTransaction = <span class="built_in">window</span>.IDBTransaction || <span class="built_in">window</span>.webkitIDBTransaction || <span class="built_in">window</span>.msIDBTransaction;</div><div class="line"><span class="built_in">window</span>.IDBKeyRange = <span class="built_in">window</span>.IDBKeyRange || <span class="built_in">window</span>.webkitIDBKeyRange || <span class="built_in">window</span>.msIDBKeyRange;</div></pre></td></tr></table></figure><h4 id="基本使用模式"><a href="#基本使用模式" class="headerlink" title="基本使用模式"></a>基本使用模式</h4><ol><li>打开数据库并且开始一个事务。</li><li>创建一个 object store。</li><li>构建一个请求来执行一些数据库操作，像增加或提取数据等。</li><li>通过监听正确类型的 DOM 事件以等待操作完成。</li><li>在操作结果上进行一些操作（可以在 request 对象中找到）</li></ol><blockquote><p>记住一点，任何对indexedDB数据库的操作都是异步进行的，任何操作都会有两个必定的事件权柄：<code>success</code>和<code>error</code>，以下的操作均要事情设置相应的监视事件防止出现错误，由于个人比较懒，在这里展示就不加上了</p></blockquote><h4 id="打开数据库"><a href="#打开数据库" class="headerlink" title="打开数据库"></a>打开数据库</h4><p>和mysql/sql数据库的使用一样，indexedDB的使用依旧是从打开数据库开始的，打开方式如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> request = indexedDB.open(DBname, version);</div><div class="line"><span class="comment">// DBname：数据库名； version：要打开的数据库版本号（可不传值，默认为最新版本）</span></div></pre></td></tr></table></figure><blockquote><p>版本号只能使用int类型，而不能使用浮点数，不然会导致错误</p></blockquote><p>与其它操作不同，open操作特有两个权柄：<code>upgradeneeded</code>（版本更新）和<code>blocked</code>（没有关闭连接尝试连接，（不常用））;</p><p>依据基本使用模式，正确的打开姿势应为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> request = indexedDB.open(DBname, version);</div><div class="line"></div><div class="line">request.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">request.onsuccess = funciton() &#123;&#125;;</div><div class="line">request.onupgradeneeded = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">request.onblocked = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 打开的数据库为request触发的成功事件中的event.target.result;</span></div><div class="line"></div><div class="line"><span class="comment">// 以后的操作参照这种方式创建监视事件</span></div></pre></td></tr></table></figure><blockquote><p>注：这里有一个坑，upgradeneeded（版本改动），故名思意是版本改动才会触发的事件，在MDN上的解释是“在数据库第一次被打开时或者当指定的版本号高于当前被持久化的数据库的版本号时，这个版本改动事务将被创建。”，而<code>任何对数据库结构产生改变的操作都应该在这个事件内执行</code>，至于怎么改变数据库结构，请看下文。</p></blockquote><h4 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">indexedDB.deleteDatabase(DBname);</div></pre></td></tr></table></figure><h4 id="对象存储空间"><a href="#对象存储空间" class="headerlink" title="对象存储空间"></a>对象存储空间</h4><p>关于对象存储空间，咱们可以把它看成是数据库的一个表，存储空间（表）的使用如下：</p><h5 id="打开存储空间"><a href="#打开存储空间" class="headerlink" title="打开存储空间"></a>打开存储空间</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = db.objectStore(storeName);</div></pre></td></tr></table></figure><h5 id="创建存储空间"><a href="#创建存储空间" class="headerlink" title="创建存储空间"></a>创建存储空间</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = db.createObjectStore(storeName, &#123;<span class="attr">keyPath</span>: keyName， autoIncrement: <span class="literal">true</span>&#125;);</div><div class="line"><span class="comment">// 创建存储空间</span></div></pre></td></tr></table></figure><p>创建存储空间必须设置keyPath（可以把它看成是存储空间的主键），createObjectStore方法的第二个参数对象就是对keyPath键的配置，配置对象中除了指定键为keyPath，还有另外一个属性<code>autoIncrement</code>,这个属性在MDN文档上的解释是</p><p><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/17-08-07/createObjectStore.png" alt="createStore"></p><p>通俗化讲就是<code>autoIncrement</code>属性是用来设置在被指定为keyPath的键为空时，是否自动生成keyPath值（这里有一点：不启用自动填补keyPath值时，因为keyPath是必须的，如果传入的数据中被指定为keyPath的键为空时，会导致创建存储空间失败，触发error事件）</p><h5 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h5><p>什么是索引：</p><p>当用户想要通过其它键去访问查询存储空间中的数据时，索引就派上用场了，索引可以看成是存储空间的一个副本，只不过把主键替换成你想要的键，但它并不真实存在，只是给存储空间的访问查询提供了便利。</p><p>创建方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = db.createObjectStore(storeName, &#123;<span class="attr">keyPath</span>: keyName， autoIncrement: <span class="literal">true</span>&#125;；</div><div class="line">store.createIndex(indexName, keyName, &#123; <span class="attr">unique</span>: <span class="literal">false</span>&#125;);</div><div class="line"><span class="comment">// createIndex有三个参数，第一个为索引名，第二个为设置索引的键，第三个为配置对象，unique表示是否允许重复，是否允许重复要根据存储空间的数据而定</span></div></pre></td></tr></table></figure><h5 id="填充数据"><a href="#填充数据" class="headerlink" title="填充数据"></a>填充数据</h5><p>向存储空间中填充数据有两个方法：add方法和put方法，两个方法都是向存储空间中填充数据，但add相当于插入新值，当存储空间中已有相同数据（即keyPath值相同）时会返回错误，put相当于更新原有的值，与add方法相反，put方法会更新已有的数据。</p><p>使用方式为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">store.add(obj);</div><div class="line">store.put(obj);</div><div class="line"><span class="comment">// obj为格式正确的数据对象</span></div></pre></td></tr></table></figure><h5 id="修改存储空间结构"><a href="#修改存储空间结构" class="headerlink" title="修改存储空间结构"></a>修改存储空间结构</h5><p>对于创建索引和设置keyPath的操作均视为改变数据库结构的操作，因此这些操作必须在upgradeneeded事件下进行，那么问题来了，如果你想重新配置数据库，那么应该怎么去触发这个事件呢？</p><p>解决方法有很多种，在这里介绍两种比较实用的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 第一种，关闭现有数据库连接，打开新版本号的数据库</span></div><div class="line"><span class="keyword">var</span> request = indexedDB.open(dbName, version),</div><div class="line">    db;</div><div class="line">request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    db = event.target.result;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 这里设置延时，因为数据库操作是异步进行的</span></div><div class="line">setTimeOut(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    db.close();</div><div class="line">    </div><div class="line">    request = indexedDB.open(dbName, version + <span class="number">1</span>);</div><div class="line">    request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">        db = event.target.result;</div><div class="line">    &#125;</div><div class="line">    requese.onupgradeneeded(event) &#123;</div><div class="line">        <span class="comment">// 这里是更改数据库结构的代码</span></div><div class="line">    &#125;;</div><div class="line">    </div><div class="line">&#125;, <span class="number">200</span>);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 第二种，与第一种原理相同，只不过换了另外一种方式</span></div><div class="line"><span class="keyword">var</span> request = indexedDB.open(dbName, version),</div><div class="line">    db;</div><div class="line">request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    db = event.target.result;</div><div class="line">&#125;</div><div class="line"></div><div class="line">setTimeOut(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> deleteDbRequest = db.deleteDatabase(dbName);</div><div class="line">    deleteDbRequest.onsuccess = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> openRequest = localDatabase.indexedDB.open(dbName,<span class="number">1</span>);</div><div class="line"></div><div class="line">        openRequest.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">            db = openRequest.result;</div><div class="line">        &#125;;  </div><div class="line">        openRequest.onupgradeneeded = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</div><div class="line">            <span class="comment">// 这里是更改数据库结构的代码</span></div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>在红宝书中的解释是“跨过创建对象存储空间这一步之后，接下来的所有操作都是要通过事务来完成，任何时候，只要想读取或修改数据，都要通过事务来组织所有操作”，简单点说就是事务就是一个工具，通过这个工具，你才能任意的去数据库中获取你想要的东西。</p><blockquote><p>这里需要注意一下，事务接收的DOM事件与其它操作有点不同，它接收三个事件：error（失败），abort（中止），complete（完成），至于传递额事件对象及其使用方法请参考<a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="external">MDN文档</a></p></blockquote><p>事务的所有方法及属性如下：</p><p><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/17-08-07/transaction.png" alt="transaction"></p><h4 id="创建方法"><a href="#创建方法" class="headerlink" title="创建方法"></a>创建方法</h4><p>在数据库中调用transaction（）方法进行创建事务，该方法可指定两个参数，第一个参数是事务可操作的存储空间，该参数可为数组，传递多个存储空间，第二个参数是事务的访问模式（也就是访问权限），模式有三种：读写（readwrite）、只读（readonly）、版本改变（versionchange），不设置访问模式的话默认是readonly。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 不带任何参数，表示创建一个能访问数据库中所有存储空间的事务，但这个事务只有读取的权限</span></div><div class="line"><span class="keyword">var</span> transaction = db.transaction();</div><div class="line"></div><div class="line"><span class="comment">// 指定一个存储空间</span></div><div class="line"><span class="keyword">var</span> transaction = db.transaction(storeName);</div><div class="line"></div><div class="line"><span class="comment">// 指定多个存储空间</span></div><div class="line"><span class="keyword">var</span> transaction = db.transaction([storeName1, storeName2]);</div><div class="line"></div><div class="line"><span class="comment">// 指定一个存储空间并设置读写权限</span></div><div class="line"><span class="keyword">var</span> transaction = db.transaction(storeName, <span class="string">"readwrite"</span>);</div></pre></td></tr></table></figure><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><p>在创建了事务后，可以使用objectStore（）方法传入存储空间的名称，获取存储空间对象，这个基于事务创建的存储空间对象会比createObjectStroe（）方法创建的存储空间对象多一些可使用的方法：get[取值]、delete[删除指定数据对象]、clear[清空存储空间中所有数据]等常用方法外，还有其它方法，所有方法请见下图：</p><p><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/17-08-07/store.png" alt="store"></p><blockquote><p>这部分只展示一些常用的方法，其余方法请自行参考<a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API" target="_blank" rel="external">文档</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = db.transaction(tableName, <span class="string">"readwrite"</span>).objectStore(<span class="string">"tableName"</span>),</div><div class="line">    request;</div><div class="line"><span class="comment">// 获取指定keyPath值的数据</span></div><div class="line">request = store.get(keyPathValue);</div><div class="line"></div><div class="line">request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"数据为"</span> + <span class="built_in">JSON</span>.stringify(event.target.result));</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 删除指定数据</span></div><div class="line">request = store.delete(keyPathValue);</div><div class="line"></div><div class="line">request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"删除成功"</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 清空存储空间</span></div><div class="line">request = store.clear();</div><div class="line"></div><div class="line">request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"清空了存储空间"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure><h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><p>上边说的所有操作，基本上和普通的数据库没有太大差别，而游标却是indexedDB最具特色的一个东西，与键范围结合使用将大大加快数据检索速度，同时操作也将更为方便。<br>游标的话可以看成是一个指针，指向存储空间的某个位置，每个位置上均有一个数据对象，然后可以对数据对象进行操作，游标可以按你意愿进行移动，访问你想访问的数据。<br>键范围的话则是在存储空间中再划分出来一个范围进行检索，缩小了检索的范围。</p><h4 id="创建方式"><a href="#创建方式" class="headerlink" title="创建方式"></a>创建方式</h4><p>使用openCursor（）方法进行创建，该方法接收两个参数，第一个参数为键范围实例，第二个参数为游标的移动方向。两个参数均有默认值。</p><p>移动方向有4个设置常量：</p><blockquote><ol><li>IDBCursor.NEXT(0)：下一项，为默认值。</li><li>IDBCursor.NEXT_NO_DUPLICATE(1)：下一个不重复的项。</li><li>IDBCursor.PREV(2)：前一项。</li><li>IDBCursor.PREV_NO_DUPLICATE：前一个不重复的项。</li></ol></blockquote><h4 id="游标自身（IDBCursor实例）"><a href="#游标自身（IDBCursor实例）" class="headerlink" title="游标自身（IDBCursor实例）"></a>游标自身（IDBCursor实例）</h4><p>IDBCursor实例有4个属性，分别是：</p><ol><li>direction：数值，表示游标移动的方向。</li><li>key：对象的键。</li><li>value：实际的数据对象。</li><li>primaryKey：游标使用的键（即当前存储空间或索引中设置的主键）。</li></ol><blockquote><p>以上4个属性均为只读</p></blockquote><p>另外，IDBCursor实例还有几个常用方法：</p><ol><li>update（dataObj）：更新当前游标所对应的数据对象值，dataObj为传递的新数据。</li><li>delete（）：删除当前游标所对应的数据。</li><li>continue（key）：移动游标到结果集中的下一项。参数key是可选的，不指定这个参数，游标移动到下一项；指定这个参数，游标会移动到指定键的位置。</li><li>advance（count）：向前移动count指定个项数。</li></ol><blockquote><p>这里有一点要注意，每一次移动游标成功后，触发的success事件的event.target.result为IDBCursor实例自己，但当移动方向在结果集中再无下一项，仍然移动光标的话，event.target.result的值将为undefined。</p></blockquote><p>使用方式：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = db.transaction(tableName).objectStore(storeName),</div><div class="line">    request,</div><div class="line">    cursor;</div><div class="line"></div><div class="line">request = store.openCursor(); <span class="comment">// 在这里可以传入配置好的键范围</span></div><div class="line"></div><div class="line"><span class="comment">// 读取属性值及使用方法</span></div><div class="line">request.onsuccess = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</div><div class="line">    cursor = event.target.result;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (cursor) &#123;</div><div class="line">        <span class="comment">// 必须进行判断</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"数据对象为"</span> + <span class="built_in">JSON</span>.stringify(cursor.value));</div><div class="line">        cursor.continue(); <span class="comment">// 游标移动到下一项</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><h4 id="键范围"><a href="#键范围" class="headerlink" title="键范围"></a>键范围</h4><p>使用IDBKeyRange对象创建相应的键范围<br>IDBKeyRange对象有4中不同的创建方法：only（）、lowerBound（）、upperBound（）以及bound（）；</p><ol><li>only：只取得主键值为指定值得数据。传递一个参数keyPathValue（主键值）；</li><li>lowerBound：从主键值为指定主键值的对象开始。传递两个参数：第一个keyPathValue（主键值），第二个为布尔值，表示是否包含满足条件的开始对象，true表示不包含，false表示包含，默认为false。</li><li>upperBound：到主键值为指定主键值的对象为止。传递参数与lowerBound方法相同，第二个参数为true代表不包含起止对象。</li><li>bound：最直接的方法，允许设置起始对象，结束对象，以及是否包含起止对象。</li></ol><blockquote><p>由于个人比较懒，在这里就不给大家撸代码了，直接贴上MDN文档中的代码，希望大家勿怪哈A_A</p></blockquote><p><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/17-08-07/IDBKeyRange.png" alt="IDBKeyRange"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>以上为个人总结的一些关于indexedDB操作的一些常用方式以及填的一些坑，希望对大家学习有帮助，如果有什么疑问错误的话，请指出，大家共同学习。另外，关于indexedDB更详细的操作方法请查询MDN文档或W3C官网，这里只是讲解一些常见的操作。<br>唉，写这篇博客真心累啊，期间从广州跑回学校，又从学校跑回广州，来来回回，千山万水！ - -宝宝心里苦啊···唉，还是希望这篇文章对大家有帮助吧。</p><div class="post-announce">感谢您的阅读，本文由 <a href="http://blog.minfive.com">MINFIVE</a> 版权所有。如若转载，请注明出处：MINFIVE（<a href="http://blog.minfive.com/">http://blog.minfive.com/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2016/04/03/JavaScript代码格式规范/" title="JavaScript代码格式规范"><i class="iconfont icon-prev"></i>JavaScript代码格式规范</a></div><div class="post__prev post__prev--right"><a href="/2017/09/08/2017-09-08-git-commit-message/" title="Commit Message 规范 及自动化 Changelog">Commit Message 规范 及自动化 Changelog<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div><div id="disqus_thread"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">个人博客，用于分享一些在日常学习工作甚至于生活中遇到的一些比较有趣的东西。七荤八素，胡言乱语，望各位看官见谅。</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/经验总结/">经验总结</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/日常学习/">日常学习</a><span class="block-list-count">7</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2017/10/06/2017-10-06-git-rebase/" title="使用 Git Rebase 美化 Git Commit 流程"><div class="item__cover"><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/post/17-10-06/git-rebase-cover.png" alt="使用 Git Rebase 美化 Git Commit 流程"></div><div class="item__info"><h3 class="item__title">使用 Git Rebase 美化 Git Commit 流程</h3><span class="item__text">2017年10月6日</span></div></a></li><li class="latest-post-item"><a href="/2017/10/04/2017-10-04-css-module/" title="Css Modules 小试"><div class="item__cover"><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/post/17-10-04/css-modules.png" alt="Css Modules 小试"></div><div class="item__info"><h3 class="item__title">Css Modules 小试</h3><span class="item__text">2017年10月4日</span></div></a></li><li class="latest-post-item"><a href="/2017/10/02/2017-10-02-postcss-test/" title="Postcss 小试"><div class="item__cover"><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/post/17-10-02/postcss.jpg" alt="Postcss 小试"></div><div class="item__info"><h3 class="item__title">Postcss 小试</h3><span class="item__text">2017年10月2日</span></div></a></li><li class="latest-post-item"><a href="/2017/09/08/2017-09-08-git-commit-message/" title="Commit Message 规范 及自动化 Changelog"><div class="item__cover"><img src="http://oo12ugek5.bkt.clouddn.com/blog/images/17-09-07/git.jpg" alt="Commit Message 规范 及自动化 Changelog"></div><div class="item__info"><h3 class="item__title">Commit Message 规范 及自动化 Changelog</h3><span class="item__text">2017年9月8日</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/css/">css</a></li><li class="tag-item"><a class="tag-link" href="/tags/css-modules/">css modules</a></li><li class="tag-item"><a class="tag-link" href="/tags/git/">git</a></li><li class="tag-item"><a class="tag-link" href="/tags/javascript/">javascript</a></li><li class="tag-item"><a class="tag-link" href="/tags/postcss/">postcss</a></li><li class="tag-item"><a class="tag-link" href="/tags/代码规范/">代码规范</a></li><li class="tag-item"><a class="tag-link" href="/tags/学习/">学习</a></li><li class="tag-item"><a class="tag-link" href="/tags/百度ife/">百度ife</a></li><li class="tag-item"><a class="tag-link" href="/tags/自动化/">自动化</a></li><li class="tag-item"><a class="tag-link" href="/tags/规范/">规范</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Guangzhou, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>chenxiaowu1994@outlook.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="http://oo12ugek5.bkt.clouddn.com/images/qrcode.png" alt="logo" title="MINFIVE"></div><div class="footer-top__item"><h3 class="item__title">footer.firend_link</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="http://www.vtint.cn/" title="基佬强" target="_blank">苗苗的喵喵</a></li><li class="list-item"><a href="https://jdc.jd.com" title="京东设计中心" target="_blank">JDC京东设计中心</a></li><li class="list-item"><a href="https://aotu.io/" title="京东凹凸实验室" target="_blank">凹凸实验室</a></li><li class="list-item"><a href="http://fex.baidu.com" title="百度Web前端研发部" target="_blank">百度FEX</a></li><li class="list-item"><a href="http://taobaofed.org" title="淘宝前端团队" target="_blank">淘宝FED</a></li><li class="list-item"><a href="http://tgideas.qq.com" title="腾讯互娱设计中心" target="_blank">TGIdeas</a></li><li class="list-item"><a href="http://isux.tencent.com" title="腾讯SNG设计中心" target="_blank">ISUX</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li><li class="list-item"><a href="http://sass-lang.com/" title="Syntactically Awesome StyleSheets" target="_blank">Sass</a></li><li class="list-item"><a href="http://node-swig.github.io/swig-templates/" title="JavaScript Template Engine" target="_blank">Swig</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/Mrminfive" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="https://www.zhihu.com/people/zuo-er-duo-dong-wu" target="_blank" title="zhihu"><i class="iconfont icon-zhihu"></i></a></li><li class="social-network__item"><a href="http://weibo.com/p/1005056092592491" target="_blank" title="weibo"><i class="iconfont icon-weibo"></i></a></li><li class="social-network__item"><a href="mailto:chenxiaowu1994@outlook.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var tags=["学习","javascript"],gitalk=new Gitalk({clientID:"fb94bfd31f8b097f6ba1",clientSecret:"8143d1da1e4189b423189357d58e379a9f7893a2",repo:"Mrminfive.github.io",owner:"Mrminfive",admin:["Mrminfive"],labels:tags});gitalk.render("comment-container")</script><script>var disqus_shortname="blog-v3oypjife2",disqus_config=function(){this.page.url="http://blog.minfive.com/2016/05/15/客户端存储indexedDB探究/",this.page.identifier="/2016/05/15/客户端存储indexedDB探究/",this.page.title="客户端存储indexedDB探究"};!function(){var e=document,t=e.createElement("script");t.src="https://"+disqus_shortname+".disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>